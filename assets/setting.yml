postgres:
  regex: "postgres-"
  image: "postgres:latest"
  command: "pg_dump -h ${db_host} -U ${db_user} -d ${db_name} -f ${target_dir}/${%service_name_env%_ENV_POSTGRES_DB}.dump"
  environment:
    - PGPASSWORD:${%service_name_env%_ENV_POSTGRES_PASSWORD}
    - db_user:${%service_name_env%_ENV_POSTGRES_USER}
    - db_host:%service_name%
    - db_name:${%service_name_env%_ENV_POSTGRES_DB}
    - target_dir:${BACKUP_DIR}/%service_path%

mysql:
  regex: "mysql-"
  image: "mysql:latest"
  command: "mysqldump -h ${db_host} -u ${db_user} ${db_name} > ${target_dir}/${%service_name_env%_ENV_MYSQL_DATABASE}.dump"
  environment:
    - MYSQL_PWD:${%service_name_env%_ENV_MYSQL_PASSWORD}
    - db_user:${%service_name_env%_ENV_MYSQL_USER}
    - db_host:%service_name%
    - db_name:${%service_name_env%_ENV_MYSQL_DATABASE}
    - target_dir:${BACKUP_DIR}/%service_path%

mongo:
  regex: "mongo-"
  image: "mongo:latest"
  command: "mongodump --host ${db_host} --out ${target_dir}"
  environment:
    - db_host:%service_name%
    - target_dir:${BACKUP_DIR}/%service_path%
